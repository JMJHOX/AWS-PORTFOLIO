import base64
import boto3
from botocore.exceptions import NoCredentialsError
import os


def lambda_handler(event,context):
    if (event['base64']):
        data = base64.b64decode(event['base64'])
        upload_to_aws(data,event['filename'])
    return 'error'
    
def upload_to_aws(local_file, s3_file):
    s3 = boto3.client('s3')
    s3res = boto3.resource('s3')
    try:
        
        obj = s3res.Object(os.environ['BUCKET_NAME'],s3_file + '.pdf')
        obj.put(Body=local_file)
        url = s3.generate_presigned_url(
            ClientMethod='get_object',
            Params={
                'Bucket': os.environ['BUCKET_NAME'],
                'Key': s3_file
            },
            ExpiresIn=24 * 3600
        )

        print("Upload Successful", url)
        return url
    except FileNotFoundError:
        print("The file was not found")
        return None
    except NoCredentialsError:
        print("Credentials not available")
        return None